{% import "bootstrap/utils.html" as utils %}
{% extends 'base.html' %}
{% block blockname %}
Lista de Eventos
{% endblock blockname %}

{% block body %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.24/datatables.min.css" />

<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.24/datatables.min.js"></script>
<div class="container text-center">
    <div class="outer">
        <div class="middle">
            <div class="inner">
                <br />
                {{ utils.flashed_messages() }}
                <br />
                <h1 style="text-align:center;">Listado de Eventos</h1>
                {% if eventos %}
                <hr class="intro-divider">
                <div class="center">
                    <table class="table table-striped table-bordered" >
                        <thead>
                            <tr class="text-center">
                                <th width="20%"> # </th>
                                <th width="20%"> Evento </th>
                                <th width="20%"> Hora </th>
                                <th width="15%"> Ver Imagen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for evento in eventos %}
                            <tr>

                                <td>
                                    {{ evento.id }}
                                </td>

                                <td>
                                    {{ evento.evento }}
                                </td>
                                <td>
                                    {{ evento.hora }}
                                </td>
                                <td>
                                    <button type="button" class="btn btn-primary" data-toggle="modal"
                                        onclick="cargaimg('{{ evento.path }}','{{ evento.evento }}','{{ evento.hora }}')"
                                        data-target="#myModal">
                                        Ver
                                    </button>
                                </td>

                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% else %}
                <hr class="intro-divider">
                <div style="text-align: center">
                    <h3> No hay Eventos!!! </h3>

                </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title" id="title"></h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <img src="" alt="" id="CaptchaImg" style="width:100%">
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
            </div>

        </div>
    </div>
</div>
<script>
    function cargaimg(path, cam, hora) {

        $.ajax({
            url: '/videostream/get_imagen',
            data: JSON.stringify({ path: "/home/pi/Documents/WebServer/Imagenes/frente/frente-06-Mar-2021-06:45:50.jpg" }),
            contentType: 'application/json;charset=UTF-8',
            type: 'POST',
            success: function (response) {
                src = 'data:image/png;base64,' + response;

                $("#CaptchaImg").attr("src", src);
                $("#title").html(cam + " - " + hora);
            },


        });

    };
    $(document).ready(function () {

            $('table').DataTable();
    })
</script>
{% endblock %}